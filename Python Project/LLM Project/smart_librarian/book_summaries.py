book_summaries_dict = {
    "Red Rising": (
        "Darrow, a low-caste Red mining Mars, discovers the ruling Golds have lied about the planet. "
        "After a personal tragedy, he's remade to pass as a Gold and sent into their brutal Institute. "
        "Inside a war-game that mimics empire, he builds alliances, breaks tribes, and learns what it "
        "will cost to spark a revolution from within."
    ),
    "Fourth Wing": (
        "Violet Sorrengail is forced into Basgiath War College, where most cadets die before graduation. "
        "She must survive trials, bond with a dragon, and navigate a dangerous attraction to a powerful "
        "rider. As conspiracies surface, Violet faces the truth about the war and what she's willing to "
        "risk to live—and love."
    ),
    "The Naturals": (
        "Cassie, a teen profiler, joins a covert FBI program that trains gifted kids to solve cold cases. "
        "When a new killer mimics her mother's unsolved murder, the case turns personal. Cassie's instincts "
        "sharpen as the team is targeted, forcing her to confront family secrets and the limits of talent."
    ),
    "The Housemaid": (
        "Millie takes a live-in job with a wealthy family that looks perfect from the outside. Strange rules, "
        "gaslighting, and a locked attic hint at a trap she can't see yet. As tensions snap, hidden agendas "
        "come to light and the power dynamic flips in a way no one expects."
    ),
    "Addicted to You": (
        "Lily hides sex addiction; Loren hides alcoholism. They fake a relationship to cover their habits, "
        "then discover real feelings complicate the lie. Recovery, relapse, and family pressure force them "
        "to choose between enabling each other and growing up together."
    ),
    "Keeping 13": (
        "After trauma and scandal, Shannon and rugby star Johnny try to rebuild trust and a future. Gossip, "
        "injuries, and family expectations threaten to tear them apart. Healing means boundaries, honesty, "
        "and learning that first love needs more than chemistry to last. (Note: this is Book 2—reading "
        "Binding 13 first helps.)"
    ),
    "Wolf Hall": (
        "Thomas Cromwell rises from obscurity to become Henry VIII's indispensable strategist. He maneuvers "
        "law, religion, and court intrigue to secure the king's annulment and break with Rome. Through "
        "ledgers and leverage, he builds a new kind of power—and pays the personal cost for wielding it."
    ),
    "The Haunting of Hill House": (
        "A researcher assembles volunteers to test whether Hill House is truly haunted. Lonely, suggestible "
        "Eleanor feels the house press into her mind until she can't tell what's real. The terror lies in "
        "the ambiguity: is the house alive, or is Eleanor unraveling?"
    ),
    "Atomic Habits": (
        "Small, consistent improvements compound into outsized results. Clear explains the cue–craving–response–reward "
        "loop and how to redesign your environment. The core move is identity-based change—become the kind of "
        "person who does the habit, then let behavior follow."
    ),
    "Thinking, Fast and Slow": (
        "Kahneman maps two modes of thought: fast, intuitive System 1 and slow, analytical System 2. He shows "
        "how biases—loss aversion, anchoring, availability—distort judgment. The takeaway: we can't delete bias, "
        "but we can design decisions to blunt it."
    ),
    "The Lean Startup": (
        "Startups win by learning faster than uncertainty can kill them. Build a Minimum Viable Product, measure "
        "real user behavior, then learn whether to pivot or persevere. Replace vanity metrics with 'innovation "
        "accounting' so evidence, not ego, guides the roadmap."
    ),
    "Braiding Sweetgrass": (
        "A botanist weaves Indigenous teachings with scientific practice to reframe how we relate to the living "
        "world. Reciprocity and gratitude replace extraction as guiding ethics. Stories of plants and restoration "
        "show that attention itself can heal places—and people."
    ),
    "The Vanishing Half": (
        "Twin sisters flee their small Southern town; one chooses to pass as white, the other doesn't. Their "
        "paths split families across race, class, and geography. Years later, their daughters' lives intersect, "
        "exposing long-kept secrets and the costs of reinvention."
    ),
    "Neuromancer": (
        "Washed-up hacker Case is hired for a last big job that reaches into the cores of megacorps and AIs. "
        "With street samurai Molly, he dives into cyberspace on a heist that keeps changing shape. The mission "
        "becomes a struggle over identity and control in a networked world."
    ),
    "The Immortal Life of Henrietta Lacks": (
        "In 1951, doctors took Henrietta Lacks's cancer cells without consent; her 'HeLa' line transformed "
        "medicine. Decades later, her family learns what happened and grapples with exploitation, profit, and "
        "access. The book threads scientific breakthroughs with a human story about consent and inequality."
    ),
    "The Miracle of Mindfulness": (
        "Nhat Hanh offers simple practices for bringing full attention to breathing, chores, and work. Mindfulness "
        "becomes a practical skill for calm, clarity, and compassion. Short exercises show how presence can change "
        "how you respond to stress."
    ),
    "Evicted": (
        "Through immersive reporting in Milwaukee, Desmond maps how eviction drives poverty. Families and landlords "
        "are caught in a system where high rent, instability, and debt feed each other. The result is a data-rich "
        "case for policy and legal reforms to keep people housed."
    ),
    "How Democracies Die": (
        "Modern democracies often erode through elected leaders who chip away at norms. The authors highlight two "
        "guardrails—mutual toleration and institutional forbearance—and how they fail. Case studies and U.S. "
        "history outline warning signs and steps that can shore up the system."
    ),
    "Watchmen": (
        "A murdered hero draws former vigilantes into a conspiracy in an alternate 1985 America. Their investigation "
        "spirals into a moral dilemma about ends and means as nuclear war looms. The book dismantles the superhero "
        "myth and asks who holds power accountable."
    ),
    "Life 3.0": (
        "Tegmark explores scenarios for advanced AI—from narrow tools to superintelligence. He lays out alignment "
        "risks, impacts on jobs and war, and governance choices that steer outcomes. The message is blunt: the "
        "future of AI is not given; it's designed."
    )
}

# Enhanced metadata for each book
book_metadata = {
    "Red Rising": {
        "author": "Pierce Brown",
        "genre": "Science Fiction",
        "themes": ["revolution", "social inequality", "mars", "dystopia", "class warfare", "transformation"],
        "target_audience": "Young Adult, Adult"
    },
    "Fourth Wing": {
        "author": "Rebecca Yarros",
        "genre": "Fantasy / Romantasy",
        "themes": ["dragons", "romance", "military academy", "survival", "war", "love"],
        "target_audience": "Young Adult, Adult"
    },
    "The Naturals": {
        "author": "Jennifer Lynn Barnes",
        "genre": "Detective Mystery / YA Crime",
        "themes": ["crime solving", "profiling", "fbi", "cold cases", "murder mystery", "teen detectives"],
        "target_audience": "Young Adult"
    },
    "The Housemaid": {
        "author": "Freida McFadden",
        "genre": "Psychological Thriller",
        "themes": ["psychological manipulation", "domestic thriller", "gaslighting", "power dynamics", "secrets"],
        "target_audience": "Adult"
    },
    "Addicted to You": {
        "author": "Krista & Becca Ritchie",
        "genre": "Romance / New Adult",
        "themes": ["addiction", "recovery", "fake relationship", "real love", "mental health", "growth"],
        "target_audience": "New Adult"
    },
    "Keeping 13": {
        "author": "Chloe Walsh",
        "genre": "Young Adult / New Adult",
        "themes": ["trauma recovery", "sports romance", "rugby", "healing", "first love", "trust"],
        "target_audience": "Young Adult, New Adult"
    },
    "Wolf Hall": {
        "author": "Hilary Mantel",
        "genre": "Historical Fiction",
        "themes": ["henry viii", "thomas cromwell", "court intrigue", "power", "religion", "politics"],
        "target_audience": "Adult"
    },
    "The Haunting of Hill House": {
        "author": "Shirley Jackson",
        "genre": "Horror",
        "themes": ["haunted house", "psychological horror", "isolation", "mental breakdown", "supernatural"],
        "target_audience": "Adult"
    },
    "Atomic Habits": {
        "author": "James Clear",
        "genre": "Self-Help",
        "themes": ["habits", "productivity", "self-improvement", "behavior change", "personal development"],
        "target_audience": "Adult"
    },
    "Thinking, Fast and Slow": {
        "author": "Daniel Kahneman",
        "genre": "Cognitive Psychology",
        "themes": ["psychology", "decision making", "cognitive bias", "behavioral economics", "thinking"],
        "target_audience": "Adult"
    },
    "The Lean Startup": {
        "author": "Eric Ries",
        "genre": "Business / Entrepreneurship",
        "themes": ["entrepreneurship", "startup", "business strategy", "innovation", "product development"],
        "target_audience": "Adult"
    },
    "Braiding Sweetgrass": {
        "author": "Robin Wall Kimmerer",
        "genre": "Nature Writing",
        "themes": ["indigenous wisdom", "nature", "ecology", "spirituality", "environmental ethics"],
        "target_audience": "Adult"
    },
    "The Vanishing Half": {
        "author": "Brit Bennett",
        "genre": "Literary Fiction / Family Saga",
        "themes": ["race", "identity", "family secrets", "passing", "sisters", "generational trauma"],
        "target_audience": "Adult"
    },
    "Neuromancer": {
        "author": "William Gibson",
        "genre": "Cyberpunk",
        "themes": ["cyberpunk", "hacking", "artificial intelligence", "virtual reality", "technology", "dystopia"],
        "target_audience": "Adult"
    },
    "The Immortal Life of Henrietta Lacks": {
        "author": "Rebecca Skloot",
        "genre": "Narrative Science / Bioethics",
        "themes": ["medical ethics", "science", "consent", "inequality", "bioethics", "true story"],
        "target_audience": "Adult"
    },
    "The Miracle of Mindfulness": {
        "author": "Thich Nhat Hanh",
        "genre": "Mindfulness / Spirituality",
        "themes": ["mindfulness", "meditation", "spirituality", "presence", "buddhism", "peace"],
        "target_audience": "Adult"
    },
    "Evicted": {
        "author": "Matthew Desmond",
        "genre": "Sociology / Urban Studies",
        "themes": ["poverty", "housing", "eviction", "social inequality", "urban studies", "policy"],
        "target_audience": "Adult"
    },
    "How Democracies Die": {
        "author": "Steven Levitsky & Daniel Ziblatt",
        "genre": "Political Science",
        "themes": ["democracy", "politics", "authoritarianism", "government", "political norms", "institutions"],
        "target_audience": "Adult"
    },
    "Watchmen": {
        "author": "Alan Moore & Dave Gibbons",
        "genre": "Graphic Novel",
        "themes": ["superheroes", "moral complexity", "power", "vigilantes", "nuclear war", "conspiracy"],
        "target_audience": "Adult"
    },
    "Life 3.0": {
        "author": "Max Tegmark",
        "genre": "Technology / Future Studies",
        "themes": ["artificial intelligence", "future", "technology", "ai alignment", "superintelligence",
                   "governance"],
        "target_audience": "Adult"
    }
}


def get_summary_by_title(title: str) -> str:
    """
    Function to retrieve full summary by exact title match.
    This will be registered as a tool for OpenAI function calling.
    """
    if title in book_summaries_dict:
        return book_summaries_dict[title]
    else:
        # Try case-insensitive search
        for book_title, summary in book_summaries_dict.items():
            if book_title.lower() == title.lower():
                return summary

        return f"Sorry, I don't have a summary for '{title}'. Available books: {', '.join(book_summaries_dict.keys())}"


def get_all_books_data():
    """Return all books with metadata for vector store loading"""
    books_data = []

    for title, summary in book_summaries_dict.items():
        metadata = book_metadata.get(title, {})

        book_record = {
            "title": title,
            "summary": summary,
            "author": metadata.get("author", "Unknown"),
            "genre": metadata.get("genre", "Unknown"),
            "themes": ", ".join(metadata.get("themes", [])),
            "target_audience": metadata.get("target_audience", "General")
        }
        books_data.append(book_record)

    return books_data


if __name__ == "__main__":
    # Test the function
    print("Testing get_summary_by_title function:")
    print(get_summary_by_title("Red Rising"))
    print("\n" + "=" * 50 + "\n")
    print("All available books:")
    for title in book_summaries_dict.keys():
        print(f"- {title}")